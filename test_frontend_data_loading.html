<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Frontend Data Loading</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .loading { background-color: #fff3cd; border-color: #ffeaa7; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Test Frontend Data Loading</h1>
    <p>This page tests if the frontend can load data from the database APIs.</p>
    
    <div id="results"></div>
    
    <script>
        const resultsDiv = document.getElementById('results');
        
        function addResult(title, status, data) {
            const div = document.createElement('div');
            div.className = `test-section ${status}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <p>Status: ${status.toUpperCase()}</p>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            resultsDiv.appendChild(div);
        }
        
        async function testEndpoint(name, url) {
            try {
                addResult(`${name} - Loading...`, 'loading', { url });
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok && Array.isArray(data)) {
                    addResult(`${name} - Success`, 'success', {
                        url,
                        count: data.length,
                        sample: data[0] || null
                    });
                } else {
                    addResult(`${name} - Error`, 'error', {
                        url,
                        status: response.status,
                        data
                    });
                }
            } catch (error) {
                addResult(`${name} - Error`, 'error', {
                    url,
                    error: error.message
                });
            }
        }
        
        async function runTests() {
            const endpoints = [
                { name: 'Banners', url: '/api/banners' },
                { name: 'Products', url: '/api/products' },
                { name: 'Categories', url: '/api/categories' },
                { name: 'Promotions', url: '/api/promotions' },
                { name: 'Slides', url: '/api/slides' },
                { name: 'Suppliers', url: '/api/suppliers' }
            ];
            
            for (const endpoint of endpoints) {
                await testEndpoint(endpoint.name, endpoint.url);
                // Small delay between requests
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            // Test category product count calculation
            addResult('Category Product Count Test', 'loading', { message: 'Testing product count calculation...' });
            
            try {
                const categoriesResponse = await fetch('/api/categories');
                const categories = await categoriesResponse.json();
                
                const productsResponse = await fetch('/api/products');
                const products = await productsResponse.json();
                
                const categoryCounts = categories.map(category => {
                    const count = products.filter(product => 
                        product.categorie_id === category.id || 
                        (product.category && product.category.id === category.id)
                    ).length;
                    
                    return {
                        category: category.title,
                        count: count,
                        display: `${count}+ produits`
                    };
                });
                
                addResult('Category Product Count Test - Success', 'success', {
                    message: 'Product counts calculated successfully',
                    categoryCounts
                });
                
            } catch (error) {
                addResult('Category Product Count Test - Error', 'error', {
                    error: error.message
                });
            }
        }
        
        // Run tests when page loads
        runTests();
    </script>
</body>
</html>





